import{createClient as S}from"https://esm.sh/@supabase/supabase-js@2";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();const B={students:[{name:"Abbud, Mathias",key:"abbud, mathias"},{name:"Mathias Abbud",key:"mathias abbud"},{name:"Abdalla, Eduardo",key:"abdalla, eduardo"},{name:"Eduardo Abdalla",key:"eduardo abdalla"},{name:"Alves, Fernanda",key:"alves, fernanda"},{name:"Fernanda Alves",key:"fernanda alves"},{name:"Annicchino, Antenor",key:"annicchino, antenor"},{name:"Antenor Annicchino",key:"antenor annicchino"},{name:"Belmonte Andriello, Talitha",key:"belmonte andriello, talitha"},{name:"Talitha Belmonte Andriello",key:"talitha belmonte andriello"},{name:"Belmonte, Ana Carolina",key:"belmonte, ana carolina"},{name:"Ana Carolina Belmonte",key:"ana carolina belmonte"},{name:"Bové Thiollier, Ana-Sofia",key:"bove thiollier, ana-sofia"},{name:"Ana-Sofia Bove Thiollier",key:"ana-sofia bove thiollier"},{name:"Ana Sofia Bove Thiollier",key:"ana sofia bove thiollier"},{name:"Branco Trindade, Maria",key:"branco trindade, maria"},{name:"Maria Branco Trindade",key:"maria branco trindade"},{name:"Brant de Carvalho, Maria",key:"brant de carvalho, maria"},{name:"Maria Brant de Carvalho",key:"maria brant de carvalho"},{name:"Burlamaque Florenzano, Giulia",key:"burlamaque florenzano, giulia"},{name:"Giulia Burlamaque Florenzano",key:"giulia burlamaque florenzano"},{name:"Cipovicci Stingelin, Felipe",key:"cipovicci stingelin, felipe"},{name:"Felipe Cipovicci Stingelin",key:"felipe cipovicci stingelin"},{name:"Covre, Lorenzo",key:"covre, lorenzo"},{name:"Lorenzo Covre",key:"lorenzo covre"},{name:"Cunningham, Max",key:"cunningham, max"},{name:"Max Cunningham",key:"max cunningham"},{name:"de Souza Naves, Antonio",key:"de souza naves, antonio"},{name:"Antonio de Souza Naves",key:"antonio de souza naves"},{name:"Dutra, Sofia",key:"dutra, sofia"},{name:"Sofia Dutra",key:"sofia dutra"},{name:"Dutra de Almeida, Joana",key:"dutra de almeida, joana"},{name:"Joana Dutra de Almeida",key:"joana dutra de almeida"},{name:"Ernanny de Mello e Silva, José Eduardo",key:"ernanny de mello e silva, jose eduardo"},{name:"José Eduardo Ernanny de Mello e Silva",key:"jose eduardo ernanny de mello e silva"},{name:"Farhat, Helena",key:"farhat, helena"},{name:"Helena Farhat",key:"helena farhat"},{name:"Fazio-Barratt, Beatrice",key:"fazio-barratt, beatrice"},{name:"Beatrice Fazio-Barratt",key:"beatrice fazio-barratt"},{name:"Beatrice Fazio Barratt",key:"beatrice fazio barratt"},{name:"Fornicola, Maria Beatriz",key:"fornicola, maria beatriz"},{name:"Maria Beatriz Fornicola",key:"maria beatriz fornicola"},{name:"Galbetti, Larissa",key:"galbetti, larissa"},{name:"Larissa Galbetti",key:"larissa galbetti"},{name:"Gaz, Leo",key:"gaz, leo"},{name:"Leo Gaz",key:"leo gaz"},{name:"Giannella, Manuela",key:"giannella, manuela"},{name:"Manuela Giannella",key:"manuela giannella"},{name:"Guimarães, Gabriela",key:"guimaraes, gabriela"},{name:"Gabriela Guimaraes",key:"gabriela guimaraes"},{name:"Guimarães, João",key:"guimaraes, joao"},{name:"Joao Guimaraes",key:"joao guimaraes"},{name:"Guimarães, Luca",key:"guimaraes, luca"},{name:"Luca Guimaraes",key:"luca guimaraes"},{name:"Gullo, Henrique",key:"gullo, henrique"},{name:"Henrique Gullo",key:"henrique gullo"},{name:"Hemnani, Alma",key:"hemnani, alma"},{name:"Alma Hemnani",key:"alma hemnani"},{name:"Jabur, Ana Beatriz",key:"jabur, ana beatriz"},{name:"Ana Beatriz Jabur",key:"ana beatriz jabur"},{name:"Jobim, Maria Clara",key:"jobim, maria clara"},{name:"Maria Clara Jobim",key:"maria clara jobim"},{name:"Junqueira de Azevedo, Isabela",key:"junqueira de azevedo, isabela"},{name:"Isabela Junqueira de Azevedo",key:"isabela junqueira de azevedo"},{name:"Junqueira Franco, Bruna",key:"junqueira franco, bruna"},{name:"Bruna Junqueira Franco",key:"bruna junqueira franco"},{name:"Laloni, Antonio",key:"laloni, antonio"},{name:"Antonio Laloni",key:"antonio laloni"},{name:"Lanzelotti, Maria Clara",key:"lanzelotti, maria clara"},{name:"Maria Clara Lanzelotti",key:"maria clara lanzelotti"},{name:"Lima, Isabella",key:"lima, isabella"},{name:"Isabella Lima",key:"isabella lima"},{name:"Maciel, Anna Beatriz",key:"maciel, anna beatriz"},{name:"Anna Beatriz Maciel",key:"anna beatriz maciel"},{name:"Makins Huxley, Frederico",key:"makins huxley, frederico"},{name:"Frederico Makins Huxley",key:"frederico makins huxley"},{name:"Maranhão, Gabriela",key:"maranhao, gabriela"},{name:"Gabriela Maranhao",key:"gabriela maranhao"},{name:"Marques Lisboa, Luiza",key:"marques lisboa, luiza"},{name:"Luiza Marques Lisboa",key:"luiza marques lisboa"},{name:"Mattar, Sofia",key:"mattar, sofia"},{name:"Sofia Mattar",key:"sofia mattar"},{name:"Mattar Muaccad, Maria Fernanda",key:"mattar muaccad, maria fernanda"},{name:"Maria Fernanda Mattar Muaccad",key:"maria fernanda mattar muaccad"},{name:"McNaughton Pinheiro, Helena",key:"mcnaughton pinheiro, helena"},{name:"Helena McNaughton Pinheiro",key:"helena mcnaughton pinheiro"},{name:"McNaughton Pinheiro, Stella",key:"mcnaughton pinheiro, stella"},{name:"Stella McNaughton Pinheiro",key:"stella mcnaughton pinheiro"},{name:"Mizne, Ilan",key:"mizne, ilan"},{name:"Ilan Mizne",key:"ilan mizne"},{name:"Monteiro Fulchignoni, Giulia",key:"monteiro fulchignoni, giulia"},{name:"Giulia Monteiro Fulchignoni",key:"giulia monteiro fulchignoni"},{name:"Moreau, Nina",key:"moreau, nina"},{name:"Nina Moreau",key:"nina moreau"},{name:"Muro, Catarina",key:"muro, catarina"},{name:"Catarina Muro",key:"catarina muro"},{name:"Ouro Preto, Lorenzo",key:"ouro preto, lorenzo"},{name:"Lorenzo Ouro Preto",key:"lorenzo ouro preto"},{name:"Parodi, Francesca",key:"parodi, francesca"},{name:"Francesca Parodi",key:"francesca parodi"},{name:"Passarelli, Carolina",key:"passarelli, carolina"},{name:"Carolina Passarelli",key:"carolina passarelli"},{name:"Passos, Júlia",key:"passos, julia"},{name:"Julia Passos",key:"julia passos"},{name:"Pereira, Victoria",key:"pereira, victoria"},{name:"Victoria Pereira",key:"victoria pereira"},{name:"Piwowarczyk Araujo, Catarina",key:"piwowarczyk araujo, catarina"},{name:"Catarina Piwowarczyk Araujo",key:"catarina piwowarczyk araujo"},{name:"Pompiani, Lorena",key:"pompiani, lorena"},{name:"Lorena Pompiani",key:"lorena pompiani"},{name:"Raffaini Ieno Costa, Julia",key:"raffaini ieno costa, julia"},{name:"Julia Raffaini Ieno Costa",key:"julia raffaini ieno costa"},{name:"Raffaini Ieno Costa, Pedro",key:"raffaini ieno costa, pedro"},{name:"Pedro Raffaini Ieno Costa",key:"pedro raffaini ieno costa"},{name:"Ramenzoni, Cecilia",key:"ramenzoni, cecilia"},{name:"Cecilia Ramenzoni",key:"cecilia ramenzoni"},{name:"Ribeiro, Analú",key:"ribeiro, analu"},{name:"Analu Ribeiro",key:"analu ribeiro"},{name:"Ribeiro, Maria Eduarda",key:"ribeiro, maria eduarda"},{name:"Maria Eduarda Ribeiro",key:"maria eduarda ribeiro"},{name:"Sabbag, Beatriz",key:"sabbag, beatriz"},{name:"Beatriz Sabbag",key:"beatriz sabbag"},{name:"Sabie, Ana",key:"sabie, ana"},{name:"Ana Sabie",key:"ana sabie"},{name:"Saddi, Anne Sophie",key:"saddi, anne sophie"},{name:"Anne Sophie Saddi",key:"anne sophie saddi"},{name:"Sapoznik, Theo",key:"sapoznik, theo"},{name:"Theo Sapoznik",key:"theo sapoznik"},{name:"Schlesinger, Elias",key:"schlesinger, elias"},{name:"Elias Schlesinger",key:"elias schlesinger"},{name:"Schwartz, Manuela",key:"schwartz, manuela"},{name:"Manuela Schwartz",key:"manuela schwartz"},{name:"Securato, Ana Carolina",key:"securato, ana carolina"},{name:"Ana Carolina Securato",key:"ana carolina securato"},{name:"Seferian, Lorenzo",key:"seferian, lorenzo"},{name:"Lorenzo Seferian",key:"lorenzo seferian"},{name:"Shor, Gabriel",key:"shor, gabriel"},{name:"Gabriel Shor",key:"gabriel shor"},{name:"Soares, Pedro",key:"soares, pedro"},{name:"Pedro Soares",key:"pedro soares"},{name:"Spritzer Sapoznik, Bruno",key:"spritzer sapoznik, bruno"},{name:"Bruno Spritzer Sapoznik",key:"bruno spritzer sapoznik"},{name:"Suryanarayanan, Advaith",key:"suryanarayanan, advaith"},{name:"Advaith Suryanarayanan",key:"advaith suryanarayanan"},{name:"Terpins, Beni",key:"terpins, beni"},{name:"Beni Terpins",key:"beni terpins"},{name:"Thomas, Gabriel",key:"thomas, gabriel"},{name:"Gabriel Thomas",key:"gabriel thomas"},{name:"Vella, Thereza",key:"vella, thereza"},{name:"Thereza Vella",key:"thereza vella"},{name:"Verdi, Luca",key:"verdi, luca"},{name:"Luca Verdi",key:"luca verdi"},{name:"Viseu, Luisa",key:"viseu, luisa"},{name:"Luisa Viseu",key:"luisa viseu"},{name:"Xirau, Isabella",key:"xirau, isabella"},{name:"Isabella Xirau",key:"isabella xirau"},{name:"Yue, Justin",key:"yue, justin"},{name:"Justin Yue",key:"justin yue"},{name:"Zurita Guedes, Maria Eduarda",key:"zurita guedes, maria eduarda"},{name:"Maria Eduarda Zurita Guedes",key:"maria eduarda zurita guedes"},{name:"Nascimento, Roney Lima do",key:"nascimento, roney lima do"},{name:"Roney Lima do Nascimento",key:"roney lima do nascimento"},{name:"Nascimento, Roney",key:"nascimento, roney"},{name:"Roney Nascimento",key:"roney nascimento"}]},M="https://gjvtncdjcslnkfctqnfy.supabase.co",C="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqdnRuY2RqY3NsbmtmY3RxbmZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5NzM0MDEsImV4cCI6MjA1OTU0OTQwMX0.AzALxUUvYLJJtDkvxt7efJ7bGxeKmzOs-fT5bQOndiU",u=S(M,C);let m=null,v=null,k,f,l,s,c,g,d,p,h,b;function y(r){return r?r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z\s]/g,"").replace(/\s+/g," ").trim():""}function I(r){const a=y(r).split(" ").filter(e=>e.length>0);if(a.length<2)return null;const t=[a.join(" "),`${a[0]} ${a[a.length-1]}`,a.length>2?`${a[0]} ${a[1]}`:null,a.length>2?`${a[1]} ${a[a.length-1]}`:null].filter(Boolean);for(const e of t){const n=B.students.find(o=>y(o.key)===e||y(o.name)===e);if(n)return n}return null}const A=r=>{!k||!f||(k.classList.remove("hidden"),f.classList.add("hidden"))},z=r=>{!l||!s||(r==="verify"?(l.classList.add("hidden"),s.classList.remove("hidden"),h&&m&&(h.textContent=m.name)):(l.classList.remove("hidden"),s.classList.add("hidden")))};async function L(r){r.preventDefault();const i=l.querySelector('button[type="submit"]'),a=i.textContent;i.disabled=!0,i.textContent="Searching...";try{const t=g.value.trim(),e=I(t);if(!e)throw new Error("Name not found in the L6 student list. Please check your spelling and try again.");const{data:n,error:o}=await u.rpc("find_enrichment_student",{p_full_name:e.name});if(o)throw o;if(!n||n.length===0)throw new Error("Student record not found in the database. Please contact support.");m={...n[0],name:e.name,whitelistKey:e.key},z("verify")}catch(t){alert(`Error: ${t.message}`)}finally{i.disabled=!1,i.textContent=a}}async function w(r){r.preventDefault();const i=d.value.trim(),a=document.getElementById("sendCodeBtn");if(!i){alert("Please enter your school email address.");return}if(!i.endsWith("@stpauls.br")){alert("Please use your St. Paul's school email (@stpauls.br).");return}a.disabled=!0,a.textContent="Sending...";try{const{data:t,error:e}=await u.auth.signInWithOtp({email:i,options:{shouldCreateUser:!0,emailRedirectTo:void 0}});if(e)throw e.message.includes("rate")?new Error("Too many attempts. Please wait a moment and try again."):e;b&&(b.textContent=i),sessionStorage.setItem("casStudentEmail",i),alert("Verification code sent! Please check your email inbox (and spam folder).");let n=60;a.textContent=`Resend in ${n}s`,v=setInterval(()=>{n--,n<=0?(clearInterval(v),a.disabled=!1,a.textContent="Resend Code"):a.textContent=`Resend in ${n}s`},1e3)}catch(t){console.error("Error sending OTP:",t),alert(`Error sending code: ${t.message}`),a.disabled=!1,a.textContent="Send Code"}}async function E(r){r.preventDefault();const i=d.value.trim(),a=p.value.trim(),t=document.getElementById("verifyBtn");if(!i||!a){alert("Please enter both email and verification code.");return}t.disabled=!0,t.textContent="Verifying...";try{if(a==="123456"&&window.location.hostname==="localhost"){console.warn("Using test code for development"),sessionStorage.setItem("casStudent",JSON.stringify(m)),sessionStorage.setItem("casStudentEmail",i),window.location.href="/pages/enrolment.html";return}const{data:e,error:n}=await u.auth.verifyOtp({email:i,token:a,type:"email"});if(n)throw n;sessionStorage.setItem("casStudent",JSON.stringify(m)),sessionStorage.setItem("casStudentEmail",i),window.location.href="/pages/enrolment.html"}catch(e){alert(`Verification failed: ${e.message}`)}finally{t.disabled=!1,t.textContent="Verify & Continue"}}async function P(){m=null,g.value="",d.value="",p.value="",z("find")}document.addEventListener("DOMContentLoaded",()=>{if(k=document.getElementById("auth-view"),f=document.getElementById("enrolment-view"),l=document.getElementById("form-find-student"),s=document.getElementById("form-verify-code"),document.getElementById("sign-out-button"),c=document.getElementById("change-name-button"),g=document.getElementById("fullName"),d=document.getElementById("email"),p=document.getElementById("token"),document.getElementById("course-list"),h=document.getElementById("student-name-display"),b=document.getElementById("student-email-display"),l&&l.addEventListener("submit",L),s){s.addEventListener("submit",E);const r=document.getElementById("sendCodeBtn");r&&r.addEventListener("click",w),document.getElementById("verifyBtn")}c&&c.addEventListener("click",P),window.location.pathname.includes("enrolment")?J():(A(),z("find"))});async function J(){const{data:{session:r}}=await u.auth.getSession();if(!r){alert("Please complete authentication first."),window.location.href="/";return}typeof fetchAndDisplayCourses=="function"&&fetchAndDisplayCourses()}
